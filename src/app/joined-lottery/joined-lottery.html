@switch (lottery.status()) {
  @case ('loading') {
    <p-progress-spinner
      class="full"
      ariaLabel="loading"
    />
  }
  @case ('error') {
    <app-go-home-button/>
  }
  @case ('resolved') {
    <h1 class="title">
      <span>Lottery: {{ lottery.value()!.name }}</span
      ><span class="actions"><app-share-lottery-button [lotteryId]="lottery.value()!.name"/></span>
    </h1>
    @if (previousExtractions.status() === 'loading') {
      <p-progress-spinner
        class="full"
        ariaLabel="loading"
      />
    } @else if (previousExtractions.status() === 'resolved') {
      @if (lastExtraction(); as lastExt) {
        <p-fieldset legend="Current Extraction">
          <app-current-extraction
            [currentExtraction]="lastExt"
            (reload)="previousExtractions.reload()"
          />
        </p-fieldset>
      }
    }
    <p-fieldset
      legend="Numbers for next extraction"
      [formGroup]="nextExtractionForm"
    >
      <div class="chosen-numbers-container">
        <div class="label-with-icon emp">
          <span class="pi pi-clock"></span>{{ nextExtractionTime() }}
        </div>
        <div class="chosen-numbers">
          <p-float-label variant="in">
            <label>Chosen numbers</label>
            <input
              pInputText
              formControlName="chosenNumbers"
              placeholder="0,1,2,3,4,5,6,7,8,9"
            />
          </p-float-label>
          <p-message
            severity="secondary"
            size="small"
            variant="simple"
          >10 numbers (0-99) separated by comma
            @if (currentNumbersInserted$ | async; as cni) {
              [{{ cni }} inserted]
            }
          </p-message>
        </div>
        <p-button
          type="submit"
          icon="pi pi-save"
          label="Save"
          [loading]="savingChosenNumbers()"
          (onClick)="saveChosenNumbers()"
        />
      </div>
    </p-fieldset>

    @switch (previousExtractions.status()) {
      @case ('loading') {
        <p-progress-spinner
          class="full"
          ariaLabel="loading"
        />
      }
      @case ('resolved') {
        @let prevExtr = previousExtractions.value();
        @if (prevExtr?.length) {
          <p-fieldset
            legend="Previous extractions"
            [toggleable]="true"
            [collapsed]="true"
          >
            <div class="previous-extractions-container">
              @for (extraction of prevExtr; track extraction.extractionTime) {
                <div class="previous-extraction">
                  <div class="extraction-time">
                    <div class="label-with-icon emp">
                      <span class="pi pi-clock"></span>
                      {{ extraction.extractionTime | toLocalDateString }}
                    </div>
                    <app-extraction-stats
                      [lotteryId]="lottery.value()!.name"
                      [extractionTime]="extraction.extractionTime"
                      [smallButton]="true"
                    />
                  </div>
                  <app-winning-chosen-numbers
                    [extraction]="extraction"
                  ></app-winning-chosen-numbers>
                </div>
              }
            </div>
          </p-fieldset>
        }
      }
    }
  }
}
